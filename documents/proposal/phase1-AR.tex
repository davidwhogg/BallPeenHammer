%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%    phase1-AR.tex  (use only for Archival Research and Theory proposals; 
%                     use phase1-GO.tex for General Observer and Snapshot
%                     proposals and phase1-DD.tex for GO/DD proposals).
%
%    HUBBLE SPACE TELESCOPE
%    PHASE I ARCHIVAL & THEORETICAL RESEARCH PROPOSAL TEMPLATE 
%    FOR CYCLE 21 (2013)
%
%    Version 1.0, December  1, 2012.
%
%    Guidelines and assistance
%    =========================
%     Cycle 21 Announcement Web Page:
%
%         http://www.stsci.edu/hst/proposing/docs/cycle21announce 
%
%    Please contact the STScI Help Desk if you need assistance with any
%    aspect of proposing for and using HST. Either send e-mail to
%    help@stsci.edu, or call 1-800-544-8125; from outside the United
%    States, call [1] 410-338-1082.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% The template begins here. Please do not modify the font size from 12 point.

\documentclass[12pt]{article}
\usepackage{phase1}

\newcommand{\project}[1]{\textsl{#1}}
\newcommand{\HST}{\project{HST}}
\newcommand{\WFC}{\project{WFC3}}
\newcommand{\MAST}{\project{MAST}}
\newcommand{\dd}{\mathrm{d}}

\begin{document}

%   1. SCIENTIFIC JUSTIFICATION
%       (see Section 9.1 of the Call for Proposals)
%
%
\justification          % Do not delete this command.
% Enter your scientific justification here.

Precise calibration of the detector in an astronomical imaging camera
is not trivial---and it is only harder if it is in space.
Fundamentally, the sensitivity of the device must be calibrated with
incident photons; no artificial light source is available; even if an
artificial source \emph{were} available, it could not be designed to
illuminate the device exactly as does a star or other astronomical
source.

The imaging devices of \HST\ are calibrated by a number of
methods:
\\ $\bullet$ \project{laboratory calibration}: The instrument was illuminated
  in the laboratory pre-flight.  In principle this calibration can be
  done perfectly, but \textsl{(a)}~usually the calibration
  illumination does not illuminate the instrument exactly as does an
  in-flight star observation, and \textsl{(b)}~usually the light
  source does not have a completely appropriate SED.  The laboratory
  calibration happens pre-launch, so changes in the instrument through
  launch and age cannot be captured, nor can some aspects of in-launch
  environment (loading, temperature, pressure).
\\ $\bullet$ \project{standard stars}: On a regular schedule, well-understood
  standard stars are placed in the instrument focal plane to test the
  on-orbit throughput of the device.  These observations are key to
  instrument monitoring, but they don't calibrate the device at the
  pixel level; they provide only overall throughput measurements.
\\ $\bullet$ \project{grid test}: The throughput measurements are transferred
  out to the entire device by grid tests, in which standards or a star
  field are stepped over the instrument focal plane.  This brings the
  same astronomical source to many different focal-plane positions; it
  permits relative calibration of different parts of the detector.
  The grid, however, is not dense at the pixel level.  The grid test
  does not provide a pixel-to-pixel flat field; it only calibrates the
  flat on large scales.
\\ $\bullet$ \project{super-flat}: The only in-flight source of
  pixel-to-pixel sensitivity information are the photons detected in
  the sky---the blank parts of the imaging.  These photons can be
  combined (with masking of detected astronomical sources) into a
  pixel-level sensitivity map.  Unfortunately, this map is a
  sensitivity to the \emph{sky} not to a \emph{star}: The sky has a
  different SED than any star.  More importantly, the
  uniform-brightness sky illuminates the device differently than any
  star.  This problem is a bigger problem for open-structure
  ground-based telescopes than it is for \HST, but it isn't known
  to be negligible for \HST.

There is no method---not even any \emph{combination of methods}---that
can be used to all of \textsl{(1)}~test the calibration of the
detector in-flight, \textsl{(2)}~provide information on pixel-to-pixel
relative sensitivity (small scales), \textsl{(3)}~illuminate the
detector as stars do, and \textsl{(4)}~illuminate with the SED or
color of astronomical sources of interest.  It is possible that these
things don't matter---that every pixel of every \HST\ instrument is
properly calibrated---but it is close to impossible to know with the
calibration data available at present.  That is, if the flat
appropriate to stellar sources is different at fine (pixel-level)
angular scales from the flat appropriate to sky photons, that problem
would not appear strongly in current calibration data.

\textbf{Here we propose to calibrate \WFC\ at the pixel
  level using all of the science data availble in \MAST.}
Importantly, we will build this calibration from the astronomical
sources in the data, \emph{not} the blank-sky parts of the imaging.
By construction, the flats we produce will be built from sources with
astrophysically relevant SEDs.

In general there are two approaches for self-calibration of this kind.
The first---what we might call ``traditional'' self-calibration---is
built on the principle that if the \emph{same object} is observed at
\emph{different focal-plane positions} the inferences made ought to be
independent of focal-plane position.  This kind of self-calibration is
most effective when the observatory obeys calibration-oriented
observing strategies (CITE HOLMES), and those strategies involve
multiple observations for most sources.  The simplest kind of
self-calibration is the ``grid test'' mentioned above, but much more
sophisticated versions have been used to calibrate the \project{Sloan
  Digital Sky Survey} (CITE PADMANABHAN) and XXX (CITE).  Traditional
self-calibration (beyond the grid test) is not applicable to most
\HST\ instruments, because sources are rarely observed multiple times,
and when they are it is usually on one of a small number of
small-angle dithers.

In the second approach---what we might call ``probabilistic''
self-calibration---the fundamental principle is that no \emph{pixel}
will see a \emph{special set of astronomical objects}.  (Of course
this assumption is wrong in important ways, to which we will return
below.)  This kind of self-calibration is applicable in (almost) any
observing strategy, provided that the imager has been used to make
\emph{an enormous number of observations}.

In a probabilistic self-calibration, the idea is that the probability
distribution function (PDF) for image patches output by any exposure
in any region of the focal plane ought to match well the PDF in any
\emph{other} region of the focal plane.  If the calibration parameters
get set to bad values, the observed image patches will contain
imprints of the calibration errors, related to the location on the
focal plane from which they are taken.  The simplest version of
probabilistic self-calibration is the construction of the
``super-flat'' in the current \WFC\ calibration strategy; the
super-flat is constructed by forcing statistics of the pixel values to
be constant across the device.  The most extreme version of
probabilistic self-calibration would be to construct highly
informative prior PDFs for astronomical images and find the
calibration parameters at which the output images match best those
priors!  Here we propose to do something intermediate, much more
ambitious and informative than the super-flat, but tractable with
current \WFC\ data and computation.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   2. ANALYSIS PLAN
%       (see Section 9.6 of the Call for Proposals)
%
%
\describearchival       % Do not delete this command.
% Enter your analysis plan here.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

...define sky flat, object flat, and zero and dark and etc...

Fundamentally, our plan is to consider an enormous number $N$ of small
patches $D_n$ of calibrated imaging.  Each patch $D_n$ is coming from
a particular location in the device centered on pixel $m$.  The idea
behind the probabilistic self-calibration is that when the device is
properly calibrated (in dark, sky flat, and object flat), every pixel
$m$ produces the same \emph{distribution} or pdf $p(D)$ for patches
$D$.  In this formulation, it is possible to think of a total data
likelihood $L$ that is the product of the pdf for patches $p(D)$
evaluated at every observed (calibrated) patch $D_n$.  As calibration
gets better, this distribution will get more informative, or more
peaked around patches that are possible given the astronomical source
population (mainly unresolved points) and the point-spread function.

In equations, the theory is
\begin{eqnarray}
p_n &\equiv& p(D_n)
\\
\ln L &=& \sum_n \ln p_n
\\
p_n &\approx& \frac{1}{N}\,\sum_{n'\neq n} K([D_n - D_{n'}]^2)
\\
\frac{\dd p_n}{\dd \theta_j} &=& \frac{1}{N}\,\sum_{n'\neq n} \left[
  \frac{\dd D_n}{\dd \theta_j}\cdot(D_n - D_{n'})
 -\frac{\dd D_{n'}}{\dd \theta_j}\cdot(D_n - D_{n'})
  \right]\,K'([D_n - D_{n'}]^2)
\quad ,
\end{eqnarray}
where $p_n \equiv p(D_n)$ is the pdf for patches evaluated at patch
$D_n$, this pdf is modeled or approximated as a kernel density
estimate with kernel $K(\cdot)$, $\theta_j$ is a parameter of the sky
flat, object flat, or dark, the derivative $\dd p_n / \dd \theta_j$ is
obtained by chain rule but most of the terms in this sum are precisely
zero (the system is sparse).  The kernel density estimate (CITE KDE)
is a data-driven model for a pdf which approximates the probability
for any paritcular datum $D_n$ with the density of \emph{other} data
$D_{n'}$ in data space nearby to $D_n$.  That density is obtained by
smoothing and summing the ``mixture of delta functions'' implied by
the full data sample.  The sparseness in the derivative calculation
arises because each pixel calibration parameter only touches the
(tiny) fraction of patches that touch one particular pixel.

...how is the ``no pixel is special'' assumption wrong?..

...what do we plan to do as our zeroth project and plan?..

...flat as a function of color...

%   3. MANAGEMENT PLAN
%       (see Section 9.7 of the Call for Proposals)
%
%  Provide a concise, but complete, management plan. This plan will be used
%  by the review panels to assess the likely scale of the proposed research
%  program. Proposers should include a schedule of the work required to
%  achieve the scientific goals of the program, a description of the roles of the
%  PI, CoIs, postdocs, and students who will perform the work, and a plan to
%  disseminate the results to the community.
%
\budgetnarrative       % Do not delete this command. CALLS the Management Plan header in the Style File (IGNORE the command name of budgetnarrative
% Enter your management plan here.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%   4. PAST HST USAGE
%       (see Section 9.8 of the Call for Proposals)
%
%        List here the program numbers and data status for all accepted GO/AR/SNAP 
%        programs of the PI in at least the last four HST Cycles. Include a list of refereed publications 
%        resulting from these programs.       
%
%       Note that the description of past HST usage  DOES NOT count against the page limits of the proposal.
%
\pasthstusage  % Do not delete this command.

None of the investigators has an approved \HST\ program in any of the
last four cycles.  That said, PI Hogg has been involved at a data
analysis and consulting level on the large \project{PHAT} project to
image the M31 disk.  This program has generated many refereed papers,
with co-authorship by Hogg only in...  ...Hogg has also been involved
in MARSHALL PROGRAMS?..

...FADELY?..

% List here the program numbers and data status for all accepted GO/AR/SNAP
% programs of the PI in at least the last four HST Cycles. Include a list of refereed
% publications resulting from these programs.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{document}          % End of proposal. Do not delete this line.
                        % Everything after this command is ignored.

